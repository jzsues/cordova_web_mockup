<!DOCTYPE html>
<html>
<head>
    <title>Cordova Web Mockup</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">

    <link rel="stylesheet" type="text/css" href="css/jq.ui.css" title="default"/>
    <link rel="stylesheet" type="text/css" href="css/grid.css"/>
    <link rel="stylesheet" type="text/css" href="css/icons.css"/>
    <link rel="stylesheet" type="text/css" href="css/refresh.css"/>


    <script type="text/javascript" charset="utf-8" src="./jq.mobi.js"></script>
    <script type="text/javascript" charset="utf-8" src="./cordova_detech_os.js"></script>
    <script>
        //auto load suitable cordova js lib
        detechCordova();
    </script>
    <script type="text/javascript" charset="utf-8" src="cordova/js/app.js"></script>
    <script type="text/javascript" charset="utf-8" src="./ui/jq.ui.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.debug.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.swipe.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.carousel.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.drawer.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.shake.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.alphatable.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.template.js"></script>
    <script type="text/javascript" charset="utf-8" src="./plugins/jq.scroller.js"></script>
    <script type="text/javascript" charset="utf-8" src="./js/iscroll.js"></script>
    <script type="text/javascript" charset="utf-8" src="./js/refresh.js"></script>

    <script type="text/javascript">
        /* This function runs once the page is loaded, but appMobi is not yet active */
        var webRoot = "./css/";
        $.ui.autoLaunch = false;
        $.ui.openLinksNewTab = false;
        $.ui.resetScrollers = true;

        //$.ui.nativeTouchScroll=false;
        var init = function () {
            $.ui.backButtonText = "返回";
            window.setTimeout(function () {
                $.ui.launch();
            }, 1500);
            //$.ui.removeFooterMenu(); This would remove the bottom nav menu
        };
        document.addEventListener("DOMContentLoaded", init, false);

        function loadedPanel(what) {
            //We are going to set the badge as the number of li elements inside the target
            //$.ui.updateBadge("#jqmlink", $("#jqm").find("li").length);

        }

        function unloadedPanel(what) {
            //console.log("unloaded " + what.id);
        }
        function showHide(obj, objToHide) {
            var el = $("#" + objToHide)[0];
            if (obj.className == "expanded") {
                obj.className = "collapsed";
            }
            else {
                obj.className = "expanded";
            }
            $(el).toggle();
        }

    </script>
    <script>
        var myScroll,
                pullDownEl, pullDownOffset,
                pullUpEl, pullUpOffset,
                generatedCount = 0;
        var pullDownLabelEL, pullUPLabelEL;

        function pullDownAction() {
            setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
                myScroll.refresh();		// Remember to refresh when contents are loaded (ie: on ajax completion)
            }, 1000);	// <-- Simulate network congestion, remove setTimeout from production!
        }

        function pullUpAction() {
            setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
                myScroll.refresh();		// Remember to refresh when contents are loaded (ie: on ajax completion)
            }, 1000);	// <-- Simulate network congestion, remove setTimeout from production!
        }
        var REFRESH_PULL_DOWN_STR = "下拉加载更多";
        var REFRESH_PULL_UP_STR = "上拉加载更多";
        var REFRESH_RELEASE_STR = "松开立即加载";
        var REFRESH_LOADING_STR = "加载中";
        function loaded() {
            pullDownEl = $('#pullDown');
            pullDownOffset = pullDownEl.offset().height;
            pullUpEl = $('#pullUp');
            pullUpOffset = pullUpEl.offset.height;
            pullDownLabelEL = pullDownEl.find('.pullDownLabel');
            pullUpLabelEL = pullUpEl.find('.pullUpLabel');
            myScroll = new iScroll('today_panel', {
                useTransition: true,
                topOffset: pullDownOffset,
                onRefresh: function () {
                    if (pullDownEl.hasClass('loading')) {
                        pullDownEl.removeClass('loading');
                        pullDownLabelEL.html(REFRESH_PULL_DOWN_STR);
                    } else if (pullUpEl.hasClass('loading')) {
                        pullUpEl.removeClass('loading');
                        pullUpLabelEL.html(REFRESH_PULL_UP_STR);
                    }
                },
                onScrollMove: function () {
                    if (this.y > 5 && !pullDownEl.hasClass('flip')) {
                        pullDownEl.addClass('flip');
                        pullDownEl.find('.pullDownLabel').html(REFRESH_RELEASE_STR);
                        this.minScrollY = 0;
                    } else if (this.y < 5 && pullDownEl.hasClass('flip')) {
                        pullDownEl.removeClass('flip');
                        pullDownLabelEL.html(REFRESH_PULL_DOWN_STR);
                        this.minScrollY = -pullDownOffset;
                    } else if (this.y < (this.maxScrollY - 5) && !pullUpEl.hasClass('flip')) {
                        pullUpEl.addClass('flip');
                        pullUpLabelEL.html(REFRESH_RELEASE_STR);
                        this.maxScrollY = this.maxScrollY;
                    } else if (this.y > (this.maxScrollY + 5) && pullUpEl.hasClass('flip')) {
                        pullUpEl.removeClass('flip');
                        pullUpLabelEL.html(REFRESH_PULL_UP_STR);
                        this.maxScrollY = pullUpOffset;
                    }
                },
                onScrollEnd: function () {
                    if (pullDownEl.hasClass('flip')) {
                        pullDownEl.replaceClass('flip', 'loading');
                        pullDownLabelEL.html(REFRESH_LOADING_STR);
                        pullDownAction();	// Execute custom function (ajax call?)
                    } else if (pullUpEl.hasClass('flip')) {
                        pullUpEl.replaceClass('flip', 'loading');
                        pullUpLabelEL.html(REFRESH_LOADING_STR);
                        pullUpAction();	// Execute custom function (ajax call?)
                    }
                }
            });
        }

        document.addEventListener('touchmove', function (e) {
            e.preventDefault();
        }, false);
        $.ui.ready(function () {
            console.log("$.ui.ready");
            setTimeout(loaded, 200);
        });
    </script>
</head>
<body>
<div id="jQUi">
    <!-- this is the splashscreen you see. -->
    <div id="splashscreen" class='ui-loader'>
        <img src="css/images/splash.png">
        <br><br>
        <span class='ui-icon ui-icon-loading spin'></span>

        <h1>Starting app</h1>
    </div>
    <div id="header">
        <a id='menubadge' onclick='jq.ui.toggleSideMenu()' class='menuButton'></a>

        <h1>Cordova是个好东西</h1>
    </div>

    <div id="content">
        <div id="today_panel" class="panel" style="overflow:hidden" selected="true" data-load="loadedPanel"
             data-defer="inc/today.html"
             data-unload="unloadedPanel"
             data-tab="navbar_today" data-header="header">

        </div>
        <div id="guess_panel" class="panel" data-load="loadedPanel" data-defer="inc/guess.html"
             data-unload="unloadedPanel"
             data-tab="navbar_guess" data-header="header">

        </div>

        <div id="location_panel" class="panel" data-load="loadedPanel" data-defer="inc/location.html"
             data-unload="unloadedPanel"
             data-tab="navbar_location" data-header="header">

        </div>

        <div id="self_panel" class="panel" data-load="loadedPanel" data-defer="inc/self.html"
             data-unload="unloadedPanel"
             data-tab="navbar_self" data-header="header">

        </div>

    </div>
    <!-- ------------------------------------------ -->
    <!-- navbar -->
    <div id="navbar">
        <a href="#today_panel" id='navbar_today' class='icon home'>今日推荐</a>
        <a href="#guess_panel" id='navbar_guess' class="icon target">猜你喜欢</a>
        <a href="#location_panel" id='navbar_location' class="icon picture">周边最爱</a>
        <a href="#self_panel" id='navbar_self' class="icon key">我的关注</a>
    </div>

    <nav>
        <div class='title'>Home</div>
        <ul>
            <li><a href="#jqm" class="icon home mini">Selectors</a></li>
        </ul>
        <div class='title'>UI</div>
        <ul>
            <li><a href="#jqmtransitions">Trans</a></li>
            <li><a href="#jqmui">ui</a></li>
            <li><a href="#uiapi">api</a></li>
        </ul>
        <div class='title'>Plugins</div>
        <ul>
            <li><a href="#webslider">Scroller</a></li>
            <li><a href="#webcarousel">Carousel</a></li>
            <li><a href="#webswipe">Swipe</a></li>
        </ul>
        <div class='title'>Menus</div>
        <ul>
            <li><a href="javascript:;" onclick="$.ui.toggleHeaderMenu();">Toggle Header</a></li>
            <li><a href="javascript:;" onclick="$.ui.toggleSideMenu()">Toggle Side</a></li>
            <li><a href="javascript:;" onclick="$.ui.toggleNavMenu()">Toggle Footer</a></li>
        </ul>

    </nav>

</div>

</body>
</html>
